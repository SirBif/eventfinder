(function(e,t,n){function x(t,n){this.element=t,this.options=e.extend({},i,n),this.init()}function T(){var e=this.map||{};return{center:e.center,zoom:e.zoomLevel,bbox:e.getViewBounds&&e.getViewBounds(),type:this.mtype}}function N(e,t){var n=new u.kml.Manager;n.addObserver("state",c(function(e){e.state==="finished"&&t.call(this,e)},this)),n.parseKML(e)}function C(t){var n=t.target,r=this.map.pixelToGeo(t.displayX,t.displayY);if(n!==this.map)return;t.type="map"+t.type,e(this.element).trigger(L(t,r))}function k(e){var t=e.target,n=t[e.type];A(n)&&n.call(this.element,L(e,t.coordinate))}function L(t,n){return e.Event(t.type,{originalEvent:t,geo:{latitude:n.latitude,longitude:n.longitude},target:t.target})}function A(e){return typeof e=="function"}function O(){return!!e().on}var r="jHERE",i,s,o,u,a,f,l,c=e.proxy,h,p="mouse",d="click",v="drag",m="touch",g="start",y="end",b="move",w="appId",E="authenticationToken",S=[d,"dbl"+d,p+"up",p+"down",p+b,p+"over",p+"out",p+"enter",p+"leave","longpress",v+g,v,v+y,"resize",m+g,m+y,m+b];i={appId:"69Dgg78qt4obQKxVbRA8",authToken:"Nz7ilIB_v1CRwPXxgPdvuA",zoom:12,center:[52.49,13.37],enable:["behavior","zoombar","scalebar","typeselector"],type:"map",marker:{text:"",textColor:"#333333",fill:"#ff6347",stroke:"#333333",shape:"balloon",icon:undefined},bubble:{content:"",closable:!0,onclose:e.noop},heatmap:{max:20,opacity:.8,coarseness:2}},e[r]=h={},s=x.prototype,h.defaultCredentials=function(e,t){l={id:e,token:t},f.load().is.done(function(){o.Settings.set(w,e),o.Settings.set(E,t)})},s.init=function(){f.load().is.done(c(this.makemap,this))},s.makemap=function(){var t=this,n=t.options,i=a.component,s=[],f=c(C,t),h={};i.Positioning=u.positioning.component.Positioning,l=l||{id:n.appId,token:n.authToken},o.Settings.set(w,l.id),o.Settings.set(E,l.token),e.data(t.element,r,!0),e.each(i,c(function(n,r){n=n.toLowerCase();if(~e.inArray(n,t.options.enable))return A(r)&&s.push(new r)||e.error("invalid: "+n)},t)),t.map=new a.Display(t.element,{zoomLevel:n.zoom,center:n.center,components:s}),t.type(n.type),t._mc=new a.Container,t.map.objects.add(t._mc),e.each(S,function(e,t){h[t]=[f,!1,null]}),t.map.addListeners(h)},s.center=function(e){this.map.setCenter(e)},s.zoom=function(e){this.map.set("zoomLevel",e)},s.type=function(e){var t=this.map,n={map:t.NORMAL,satellite:t.SATELLITE,smart:t.SMARTMAP,terrain:t.TERRAIN,pt:t.SMART_PT,community:t.NORMAL_COMMUNITY,satcommunity:t.SATELLITE_COMMUNITY,traffic:t.TRAFFIC};e in n?(this.mtype=e,e=n[e]):(this.mtype="map",e=n.map),t.set("baseMapType",e)},s.marker=function(t,n){var r={},s=c(k,this),o=this._mc,u="Marker";e.each(S,function(e,t){r[t]=[s,!1,null]}),n=e.extend({},i.marker,n),n.textPen=n.textPen||{strokeColor:n.textColor},n.pen=n.pen||{strokeColor:n.stroke},n.brush=n.brush||{color:n.fill},n.eventListener=r,n.icon||(u="Standard"+u),o.objects.add(new a[u](t,n))},s.nomarkers=function(){this._mc.objects.clear()},s.bubble=function(t,n){var r,s=this.map;n=e.extend({},i.bubble,n),n.content.jquery&&(n.content.css("white-space","normal"),n.content=e("<div/>").append(n.content.clone()).html()),r=s.getComponentById("InfoBubbles")||s.addComponent(new a.component.InfoBubbles),r.openBubble(n.content,{latitude:t.latitude||t[0],longitude:t.longitude||t[1]},n.onclose,!n.closable)},s.nobubbles=function(){var e;return(e=this.map.getComponentById("InfoBubbles"))&&e.closeAll()},s.kml=function(e,t,n){A(t)&&(n=t,t=!1),N.call(this,e,c(function(e){var r=this.map,i=new u.kml.component.KMLResultSet(e.kmlDocument,r);i.addObserver("state",c(function(e){var i,s;e.state==="finished"&&(t&&(i=e.container.objects.get(0),s=i.getBoundingBox(),s&&r.zoomTo(s)),A(n)&&n.call(this,e))},this)),r.objects.add(i.create())},this))},s.heatmap=function(t,n,r){var s;n=n||"value",n.match(/^density|value$/)||(n="value"),r=r||{},r.type=n,r=e.extend({},i.heatmap,r),s=new u.heatmap.Overlay(r),s.addData(t),this.map.overlays.add(s)},s.originalMap=function(e){e.call(this.element,this.map,u)},s.destroy=function(){this.map.destroy(),e.removeData(this.element),e(this.element).empty()},f={},f.is=!1,f.load=function(){var t,r,i;return f.is&&f.is.state().match(/pending|resolved/)?this:(f.is=e.Deferred(),i=function(){o=nokia,u=o.maps,o.Features.load({map:"auto",ui:"auto",search:"auto",routing:"auto",positioning:"auto",behavior:"auto",kml:"auto",heatmap:"auto"},function(){a=u.map,f.is.resolve()})},t=n.getElementsByTagName("head")[0],r=n.createElement("script"),r.src="http://js.api.here.com/se/2.5.4/jsl.js",r.type="text/javascript",r.charset="utf-8",r.onreadystatechange=function(){r.readyState.match(/loaded|complete/)&&i()},r.onload=i,t.appendChild(r),this)},h._JSLALoader=f,h.extend=function(e,t){typeof e=="string"&&A(t)&&(s[e]=t)},e.fn[r]=function(t){var n=arguments,i="plg_"+r,s;return O()||e.error(r+" requires Zepto or jQuery >= 1.7"),!t&&(s=e.data(this[0],i))?T.call(s):this.each(function(){var o;s=e.data(this,i),s?(typeof t!="string"&&e.error(r+" already initialized, expected method."),o=t,n=Array.prototype.slice.call(n,1),A(s[o])||e.error(r+": "+o+" does not exist"),f.load().is.done(function(){s[o].apply(s,n)})):(s=new x(this,t),e.data(this,i,s))})}})(jQuery,window,document);
